# fPLRNN

This repository contains the code for our PLRNN latent factor analysis. We provide here the data and scripts that generate the figures for this project.

## Installation

This software was written for Python 3.10.12 and run on an NVIDIA RTX A6000 in a Linux environment. We recommend that users install it using the Python venv module for virtual environments:

```
python -m venv path/to/virtual/environment
source path/to/virtual/environment/bin/activate
pip install -r requirements.txt
pip install .
```

## Usage

These scripts optimize machine learning models to fit the provided data and visualize the analysis of those models. Some scripts may be run as-is, and some may require command line arguments. Before running these scripts, make sure that the appropriate environment is active. Since some scripts depend on the output of other scripts, those scripts should be run in a certain order, which is addressed below.

Produce figures 3A1 and 3A2:
```
for j in {0..8}; do time for i in {0..9}; do python control_experiments_basicRNN_optimization.py --dz_idx $j --sim_group $i; done; done
python control_experiments_basicRNN_analysis.py
```

Many of the figures are derived from data produced by the `model_size_optimization.py` script.
```
python model_size_optimization.py
python model_selection.py               # Figs 3B and S2
python basicRNN_exemplar_traces.py      # Fig 2B and 2C
python basicRNN_minimal_performance.py  # Fig 2D and 2E
python PCA.py                           # Figs 4, 7, 8, and S3
python basicRNN_exemplar_PCs.py         # Fig 6
```

Figure 5 depends on data generated by `model_size_optimization.py` as well as the following:
```
python basicRNN_observation_model_analysis.py
python basicRNN_observation_model_stats.py
python basicRNN_observation_model_exemplar.py
```

Figure S1 depends on the following:
```
python reg_select_basicRNN_optimization.py
python reg_select_basicRNN_analysis.py
```

Figures are written out as pdf files to subdirectories within the `./results` directory. Please inspect the following directories:
```
results/basicRNN_control_experiment/figures  # Figs 3A1 and 3A2
results/basicRNN_model_size/figures          # Figs 2B, 2C, 2D, 2E, 3B, 4, 5, 6, 7, and 8
results/basicRNN_reg_select/figures          # Fig S1
results/linearRNN_model_size/figures         # Figs S2 and S3
```